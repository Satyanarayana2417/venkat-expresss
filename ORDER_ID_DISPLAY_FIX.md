# Order ID Display Fix

## Problem
After booking successfully, the order ID shown in the frontend (customer view) was different from the order ID shown in the admin page.

## Root Cause
The application uses **two different IDs**:

1. **Formatted Order ID** (e.g., `ORD-20251027-12345`)
   - Generated by `generateOrderId()` in `orderUtils.ts`
   - Stored in Firestore document as `orderId` and `orderNumber` fields
   - User-friendly format for display

2. **Firestore Document ID** (e.g., `abc123xyz456`)
   - Auto-generated by Firestore when document is created
   - Used internally for routing and database queries
   - Not user-friendly

### Previous Behavior
- **Frontend (Customer View)**: Displayed `order.orderNumber` (formatted ID like `ORD-20251027-12345`) ✅
- **Admin Panel**: Displayed `order.id` (Firestore document ID like `abc123xyz456`) ❌

This caused confusion as the same order showed different IDs in different parts of the application.

## Solution

### Changes Made to `AdminOrders.tsx`

#### 1. Added `orderNumber` to Order Interface
```typescript
interface Order {
  id: string;
  orderNumber: string;  // ← Added this field
  customer: string;
  email: string;
  total: number;
  status: 'pending' | 'processing' | 'shipped' | 'out-for-delivery' | 'delivered' | 'cancelled' | 'returned' | 'cancellation-pending';
  date: string;
  items: number;
  createdAt?: any;
}
```

#### 2. Extract `orderNumber` from Firestore
```typescript
snapshot.forEach((doc) => {
  const data = doc.data();
  fetchedOrders.push({
    id: doc.id,
    orderNumber: data.orderNumber || data.orderId || doc.id,  // ← Extract from Firestore
    customer: data.customer || data.customerName || 'Unknown',
    // ... rest of fields
  });
});
```

#### 3. Display `orderNumber` in Table
```typescript
// Changed from:
<TableCell className="font-medium">{order.id}</TableCell>

// To:
<TableCell className="font-medium">{order.orderNumber}</TableCell>
```

#### 4. Update Delete Modal
```typescript
// Changed from:
setOrderToDelete({
  id: order.id,
  orderNumber: order.id,  // ← Was using document ID
  customer: order.customer
});

// To:
setOrderToDelete({
  id: order.id,
  orderNumber: order.orderNumber,  // ← Now uses formatted ID
  customer: order.customer
});
```

#### 5. Update Search Filter
```typescript
// Changed from:
const matchesSearch = 
  order.id.toLowerCase().includes(searchTerm.toLowerCase()) ||
  order.customer.toLowerCase().includes(searchTerm.toLowerCase()) ||
  order.email.toLowerCase().includes(searchTerm.toLowerCase());

// To:
const matchesSearch = 
  order.orderNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||  // ← Search by orderNumber
  order.customer.toLowerCase().includes(searchTerm.toLowerCase()) ||
  order.email.toLowerCase().includes(searchTerm.toLowerCase());
```

## Result

### After Fix
- **Frontend (Customer View)**: Displays `order.orderNumber` → `ORD-20251027-12345` ✅
- **Admin Panel**: Displays `order.orderNumber` → `ORD-20251027-12345` ✅

Both views now show the same user-friendly formatted order ID!

## How It Works

### Order Creation Flow
1. User completes checkout on `Payment.tsx`
2. `generateOrderId()` creates formatted ID: `ORD-20251027-12345`
3. Order data saved to Firestore:
   ```typescript
   {
     orderId: "ORD-20251027-12345",
     orderNumber: "ORD-20251027-12345",
     customer: "John Doe",
     // ... other fields
   }
   ```
4. Firestore returns document ID: `abc123xyz456`
5. Navigation uses document ID: `/order/success/abc123xyz456`
6. Both frontend and admin display `orderNumber` from document: `ORD-20251027-12345`

### ID Usage Pattern
- **Document ID (`doc.id`)**: Used for routing, queries, and internal references
- **Order Number (`orderNumber`)**: Used for display to users (both customers and admins)

## Testing

To verify the fix:

1. **Place a New Order**
   - Go to the website and complete a purchase
   - Note the Order ID shown on the success page (e.g., `ORD-20251027-12345`)

2. **Check Admin Panel**
   - Log in to admin panel at `/admin/orders`
   - Find the order in the table
   - Verify it shows the same Order ID (e.g., `ORD-20251027-12345`)

3. **Test Search**
   - In admin panel, search for the order using the formatted ID
   - The order should be found successfully

## Files Modified
- `src/pages/admin/AdminOrders.tsx`

## Related Files
- `src/lib/orderUtils.ts` - Contains `generateOrderId()` function
- `src/pages/Payment.tsx` - Creates orders and generates IDs
- `src/pages/OrderSuccess.tsx` - Displays order ID to customers
- `src/components/RealtimeOrderCard.tsx` - Shows order cards to customers

## Benefits
✅ Consistent order ID display across all views
✅ Better user experience for customers
✅ Easier order tracking for admins
✅ Searchable by formatted order number
✅ No confusion about which ID to reference
